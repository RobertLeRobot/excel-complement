(()=>{"use strict";var e,o,n,t,a,s={14385:e=>{e.exports=function(e,o){return o||(o={}),e?(e=String(e.__esModule?e.default:e),o.hash&&(e+=o.hash),o.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},19152:(e,o,n)=>{n.d(o,{X:()=>a,x:()=>t});const t="PlanningActuelia",a="ms-excel:ofe|u|https://actuelia.sharepoint.com/:x:/r/sites/Planning-Dev/_layouts/15/Doc.aspx?sourcedoc=%7B92B818C0-9252-468E-B871-0127854FC9F7%7D&file=Planning%20-%20vDev.xlsx&action=default&mobileredirect=true";async function s(e){try{await Excel.run(async e=>{const o=e.workbook.properties;o.load("title"),await e.sync(),"PlanningActuelia"===o.title?(console.log("Déjà sur le bon fichier, affichage du taskpane."),await Office.addin.showAsTaskpane()):(console.log("Autre fichier, ouverture du planning SharePoint."),window.open(a,"_blank"))})}catch(e){console.error("Erreur dans openPlanningFile:",e),window.open(a,"_blank")}finally{e&&e.completed&&e.completed()}}Office.onReady(()=>{console.log("Complément Planning Actuelia prêt."),s()}),Office.actions.associate("openPlanningFile",s)},58394:(e,o,n)=>{e.exports=n.p+"dfdaaa4bf146369082c6.css"},60947:(e,o,n)=>{e.exports=n.p+"e001e713c2b7a130e416.js"},98362:(e,o,n)=>{e.exports=n.p+"assets/logo-filled.png"}},l={};function i(e){var o=l[e];if(void 0!==o)return o.exports;var n=l[e]={exports:{}};return s[e](n,n.exports,i),n.exports}i.m=s,i.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return i.d(o,{a:o}),o},i.d=(e,o)=>{for(var n in o)i.o(o,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},i.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),i.p="https://robertlerobot.github.io/excel-complement/dev/",i.b=document.baseURI||self.location.href,(()=>{async function e(){await Excel.run(async e=>{E.debug=!1;const o=e.workbook.worksheets.getActiveWorksheet();await o.load("name"),await e.sync(),o.protection.unprotect(),o.getRange().format.protection.locked=!0;const n=o.getRange("B:B").getUsedRange();if(await n.load("rowCount"),await e.sync(),E.debug&&console.log("nb val colonne B :",n.rowCount),"2. Planning - Consultant"===o.name){const t=n.rowCount-9;if(E.debug&&console.log("nbMissions :",t),o.getRange("B2:B3").format.protection.locked=!1,t>0){const n=o.getRange("E10"),a=o.getCell(9+t,81);await n.load("address"),await a.load("address"),await e.sync(),o.getRange(n.address+":"+a.address).format.protection.locked=!1}}if("2. Planning - Missions"===o.name){await n.load("values"),await e.sync(),E.debug&&(console.log("val colonne B :",n.values.flat()),console.log("val colonne B :",n.values.flat().filter(e=>""!==e)));const t=n.values.flat().filter(e=>""!==e).length-3;E.debug&&console.log("nb Consultants :",t);const a=o.getRange("B2");if(await a.load("values"),await e.sync(),a.format.protection.locked=!1,"00 - Congés/jours fériés"!==a.values[0][0]){const n=o.getRange("E9"),a=o.getCell(7+t,81);await n.load("address"),await a.load("address"),await e.sync(),E.debug&&console.log("Plage à débloquer :",n.address+":"+a.address),o.getRange(n.address+":"+a.address).format.protection.locked=!1}}o.protection.protect(),E.debug&&console.log("Feuille",o.name,"protégée"),await e.sync(),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de l'exécution de formatProtection :",e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}async function o(){await Excel.run(async e=>{E.debug=!1;const o=e.workbook,n=o.worksheets.getItem("2. Planning - Missions");n.protection.unprotect();const t=o.names.getItem("Modif_Missions").getRange();await t.load("address, formatConditions, rowIndex, rowCount, columnCount"),await e.sync();const a=n.getCell(t.rowIndex+t.rowCount-1,t.columnCount+3);await a.load("address"),await e.sync();const s=t.conditionalFormats;await s.load("items"),await e.sync();const l=`A${t.rowIndex+1}:${a.address}`;E.debug&&(console.log("modifMissionsRange :",t.address),console.log("globalVar.debug sRange: ",l));const i=n.getRange(l);await i.load("address"),await e.sync();const c=s.items.length;for(let o=0;o<c;o++){E.debug&&console.log(`Traitement du format ${o} sur ${c}`);const n=s.getItemAt(o);await e.sync(),E.debug&&(console.log("Format condition",n),console.log("Ancienne plage :",n.address)),n.setRanges(i),await e.sync();const t=n.getRanges();await t.load("address"),await e.sync(),E.debug&&console.log("Nouvelle plage :",t.address)}const r=o.names.getItemOrNullObject("Nb_Consultants");let d;if(await r.load("value"),await e.sync(),r.isNullObject)throw new Error("Le nom 'nbConsultants' n'existe pas dans le classeur");d=r.value,E.debug&&console.log("nbConsultants cabinet:",d);const u=n.getRange("B:B").getUsedRange();await u.load("values"),await e.sync();const g=u.values.flat().filter(e=>""!==e).length-3;E.debug&&(console.log("val colonne B :",u.values.flat()),console.log("val colonne B :",u.values.flat().filter(e=>""!==e)),console.log("nb Consultants mission:",g));const f=n.getRange("C9"),m=n.getRange(`C${8+d}`);await f.load("address"),await m.load("address"),await e.sync();const b=n.getRange(f.address+":"+m.address);if(E.debug&&console.log("Plage à cacher :",f.address+":"+m.address),await b.load("address, rowIndex, rowCount"),await e.sync(),n.getRange(`${b.rowIndex+1}:${b.rowIndex+b.rowCount-1}`).rowHidden=!1,g<d){const o=n.getRange(`C${9+g}`),t=n.getRange(`C${9+d}`);await o.load("address"),await t.load("address"),await e.sync();const a=n.getRange(o.address+":"+t.address);E.debug&&console.log("Plage à cacher :",o.address+":"+t.address),await a.load("address, rowIndex, rowCount"),await e.sync(),E.debug&&(console.log("adresse rangeToHide",a.address),console.log("rangetohide.entireRow",a.entireRow)),n.getRange(`${a.rowIndex+1}:${a.rowIndex+a.rowCount-1}`).rowHidden=!0}await e.sync(),n.getRange("B3").select(),n.protection.protect(),await e.sync(),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de l'exécution de formatMissions :",e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}async function n(){await Excel.run(async e=>{E.debug=!1;const o=e.workbook,n=o.worksheets.getItem("2. Planning - Consultant"),t=o.names.getItem("Modif_Consultant").getRange();await t.load("address, conditionalFormats, rowIndex, rowCount, columnCount"),await e.sync(),E.debug&&console.log("Modif_Consultant :",t.address,"\nFormats conditionnels :",t.conditionalFormats);const a=t.conditionalFormats;await a.load("items"),await e.sync();const s=n.getCell(t.rowIndex+t.rowCount-1,t.columnCount+3);await s.load("address"),await e.sync();const l=`A${t.rowIndex+1}:${s.address}`;E.debug&&(console.log("modifMissionsRange :",t.address),console.log("globalVar.debug sRange: ",l));const i=n.getRange(l);await i.load("address"),await e.sync();const c=a.items.length;E.debug&&console.log(`Nombre de formats conditionnels trouvés : ${c}`);for(let o=0;o<c;o++){E.debug&&console.log(`Traitement du format ${o} sur ${c}`);const n=a.getItemAt(o);if(await e.sync(),await e.sync(),E.debug){const o=n.getRanges();await o.load("address"),await e.sync(),console.log("Ancienne plage :",o.address)}if(n.setRanges(i),await e.sync(),E.debug){const o=n.getRanges();await o.load("address"),await e.sync(),console.log("Nouvelle plage :",o.address)}}await e.sync(),E.debug&&console.log("Format_Consultants appliqué avec succès."),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de l'exécution de formatConsultants :",e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}async function t(e,o){await Excel.run(async n=>{E.debug=!1;const t=n.workbook,a=t.worksheets.getItem(e),s="3. Recap"===e?1:2;a.protection.unprotect();const l=a.getRange(`C${o}:XFD${o}`).getUsedRange();await l.load("values"),await n.sync(),E.debug&&console.log("Ligne semaine val",l.values.flat());const i=t.names.getItem("Aujourdhui").getRange();await i.load("values"),await n.sync(),E.debug&&console.log("Date :",i.values[0][0]);const c=i.values[0][0],r=l.values.flat().filter(e=>""!==e).findIndex(e=>e===c)-s;if(E.debug&&console.log("Nombre de semaines (colonnes) à masquer",r),r>=0){const e=a.getCell(0,r+3),o=a.getCell(0,4);await e.load("address"),await o.load("address"),await n.sync();const t=a.getRange(`${e.address}:${o.address}`);E.debug&&(await t.load("address"),await n.sync(),console.log("Colonnes à masquer :",t.address)),await t.load("columnIndex, columnCount"),await n.sync(),E.debug&&(console.log("adresse rangeToHide",t.address),console.log("rangetohide.entireColumn",t.entireColumn));const s=a.getRangeByIndexes(0,t.columnIndex,1,t.columnCount);E.debug&&(await s.load("address"),await n.sync(),console.log("Adresse de la plage à masquer :",s.address),console.log("entireColumn",s)),s.columnHidden=!0,await n.sync()}a.protection.protect({allowFiltering:!0}),await n.sync(),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de l'exécution de formatSemaine :",e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}async function a(){await Excel.run(async o=>{E.debug=!0,E.debug&&console.log("Activation de la feuille 2. Planning - Consultant");const a=o.application;a.screenUpdating=!1,a.calculate(),await e(),await n(),await t("2. Planning - Consultant",5),a.screenUpdating=!0,await o.sync(),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de l'exécution de ActivationPlanningConsultant :",e),e instanceof OfficeExtension.Error&&console.error("Error debug info: "+JSON.stringify(e.debugInfo))})}async function s(o){E.debug=!0,E.debug&&console.log("Fonction ChgtFeuilleConsultant exécutée \nevent :",o),"ThisLocalAddin"!=o.triggerSource?(E.debug&&console.log("Modification stopée car pas demandée par l'utilisateur - après boucle"),E.isProcessing?E.debug&&console.log("Une modification est déjà en cours de traitement. Ignorée."):(E.isProcessing=!0,await Excel.run(async t=>{E.debug&&console.log("Détection de modification dans la feuille",E.nbExecModifConsultant++,"fois");const a=t.workbook,l=a.worksheets.getActiveWorksheet(),i="2. Planning - Consultant",c=t.workbook.worksheets.getItem(i);E.debug&&console.log("Désactivation temporaire du gestionnaire onChanged"),c.onChanged.remove(s);try{if(await l.load("name"),await t.sync(),E.debug&&console.log("Feuille active :",l.name),l.name===i){const s=l.getRange(o.address),i=a.names.getItem("Modif_Consultant").getRange();await t.sync(),await s.load("rowIndex, columnIndex, rowCount, columnCount, columnCount, address"),await i.load("rowIndex, columnIndex, rowCount, columnCount"),await t.sync();const c=s.rowIndex>=i.rowIndex&&s.rowIndex+s.rowCount<=i.rowIndex+i.rowCount&&s.columnIndex>=i.columnIndex&&s.columnIndex+s.columnCount<=i.columnIndex+i.columnCount;if(E.debug&&console.log("Flag Modif dans le tableau :",c),c){const e=l.getRange(o.address);await e.load("address, values, rowIndex, columnIndex, rowCount, columnCount"),await t.sync(),E.debug&&console.log("Modification détectée dans la plage Modif_Consultant sur la cellule :",e.address),await async function(e,o,n){E.debug=!0,E.debug&&(console.log("Fonction modifPlanningConsultant exécutée."),console.log("modifPlanningConsultant appelée avec :",e,o,n)),await Excel.run(async t=>{E.debug&&console.log("Début de la fonction modifPlanningConsultant");const a=t.workbook,s=a.worksheets.getActiveWorksheet(),l=a.names.getItemOrNullObject("Nb_Missions_Max");let i;if(await s.load("name"),await l.load("value"),await t.sync(),l.isNullObject)throw new Error("Le nom 'Nb_Missions_Max' n'existe pas dans le classeur");i=l.value,await e.load("address, values"),await t.sync(),E.debug&&(console.log("Feuille de calcul chargée :",s.name),console.log("Valeur de Nb_Missions_Max :",i),console.log("Adresse de la plage modifiée :",e),console.log("Numéro de la première ligne modifiée :",o+1));const c=s.getRange("B2");await c.load("values"),await t.sync(),E.debug&&console.log("Valeur de la cellule B2 chargée :",c.values[0][0]);const r=c.values[0][0],d=a.worksheets.getItem(r);await d.load("name"),await t.sync(),E.debug&&console.log("Feuille du consultant",d.name,"chargée");const u=e.values.flat();E.debug&&console.log("Nombre de jours renseigné :",u),E.debug&&console.log("Nombre de colonnes modifiées :",e.columnCount,"\nNombres de lignes modifiées :",e.rowCount);for(let a=0;a<e.rowCount;a++){E.debug&&console.log(`Traitement de la ligne ${a+1} sur ${e.rowCount}`);const l=u[a];if(""!==l){E.debug&&console.log("Nombre de jour non vide pour la ligne :",a,"\nNombre de jour :",l);const c=s.getCell(o+a,2);await c.load("values");const u=s.getCell(o+a,1);await u.load("values");const g=d.getRange("C7:C"+(parseInt(i)+6));await g.load("values"),await t.sync(),E.debug&&console.log("Nom Mission :",c.values[0][0]);const f=g.values.flat();E.debug&&console.log("Valeurs aplaties de la plage C7:C :",f);let m=f.indexOf(c.values[0][0]);if(-1!==m){E.debug&&console.log("Index trouvé pour la mission :",m);for(let o=0;o<e.columnCount;o++)d.getRange("D7").getCell(m,n+o-3).values=[[l]]}else E.debug&&console.log("Aucun index trouvé pour la mission.");k(c.values[0][0],u.values[0][0],r)}}e.clear(Excel.ClearApplyTo.contents),E.debug&&console.log("Contenu de la plage modifiée supprimé :",e.address),await t.sync(),E.debug&&console.log("Calcul déclenché après modification de la feuille",s.name),await t.sync(),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de la modification du planning : "+e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}(e,e.rowIndex,e.columnIndex),await t.sync(),await Excel.run(async e=>e.application.calculate())}s.address.includes("B2")|s.address.includes("B3")&&(E.debug&&console.log("Modification détectée dans la plage B2:B3"),await Excel.run(async e=>e.application.calculate()),await e(),await n())}E.debug=!0}catch(e){E.debug=!0,console.error("Erreur lors du traitement de la modification : "+e)}finally{E.debug&&console.log("Réactivation du gestionnaire onChanged"),c.onChanged.add(s),await Excel.run(async e=>e.application.calculate()),await t.sync(),E.isProcessing=!1,E.debug=!0}}).catch(e=>{console.error("Erreur lors de la gestion des modifications de la feuille : "+e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo)),E.isProcessing=!1,E.debug=!0}))):E.debug&&console.log("Modification stopée car pas demandée par l'utilisateur - avant")}async function l(){await Excel.run(async n=>{E.debug=!1,E.debug&&console.log("Activation de la feuille 2. Planning - Missions");const a=n.application;a.screenUpdating=!1,a.calculate(),await e(),await o(),await t("2. Planning - Missions",5),a.screenUpdating=!0,await n.sync(),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de l'exécution de ActivationPlanningMission :",e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}async function c(n){E.debug=!0,E.debug&&console.log("Fonction ChgtFeuilleMission exécutée."),"ThisLocalAddin"!=n.triggerSource?E.isProcessing?E.debug&&console.log("Une modification est déjà en cours de traitement. Ignorée."):(E.isProcessing=!0,await Excel.run(async t=>{E.debug&&console.log("Détection de modification dans la feuille",E.nbExecModifMission++,"fois");const a=t.workbook,s=a.worksheets.getActiveWorksheet(),l="2. Planning - Missions",i=t.workbook.worksheets.getItem(l);E.debug&&console.log("Désactivation temporaire du gestionnaire onChanged"),i.onChanged.remove(c);try{if(await s.load("name"),await t.sync(),E.debug&&console.log("Feuille active :",s.name),s.name===l){const l=s.getRange(n.address),i=a.names.getItem("Modif_Missions").getRange();await t.sync(),await l.load("rowIndex, columnIndex, rowCount, columnCount, columnCount, address"),await i.load("rowIndex, columnIndex, rowCount, columnCount"),await t.sync();const c=l.rowIndex>=i.rowIndex&&l.rowIndex+l.rowCount<=i.rowIndex+i.rowCount&&l.columnIndex>=i.columnIndex&&l.columnIndex+l.columnCount<=i.columnIndex+i.columnCount;if(E.debug&&console.log("Flag Modif dans le tableau :",c),c){const e=s.getRange(n.address);await e.load("address, values, rowIndex, columnIndex, rowCount, columnCount"),await t.sync(),await async function(e,o,n){E.debug=!1,E.debug&&(console.log("Fonction modifPlanningMission exécutée."),console.log("modifPlanningMission appelée avec :",e,o,n)),await Excel.run(async t=>{E.debug&&console.log("Début de la fonction modifPlanningMission");const a=t.workbook,s=a.worksheets.getActiveWorksheet(),l=a.names.getItemOrNullObject("Nb_Missions_Max");let i;if(await s.load("name"),await l.load("value"),await t.sync(),l.isNullObject)throw new Error("Le nom 'Nb_Missions_Max' n'existe pas dans le classeur");i=l.value,await e.load("address, values"),await t.sync(),E.debug&&(console.log("Feuille de calcul chargée :",s.name),console.log("Valeur de Nb_Missions_Max :",i),console.log("Adresse de la plage modifiée :",e),console.log("Numéro de la première ligne modifiée :",o+1));const c=s.getRange("B2");await c.load("values"),await t.sync();const r=c.values[0][0];E.debug&&console.log("Valeur de la cellule B2 chargée :",c.values[0][0]);const d=e.values.flat();E.debug&&console.log("Nombre de jours renseigné :",d);for(let l=0;l<e.rowCount;l++){E.debug&&console.log(`Traitement de la ligne ${l+1} sur ${e.rowCount}`);const c=d[l];if(""!==c){E.debug&&console.log("Nombre de jour non vide pour la ligne :",l,"\nNombre de jour :",c);const d=s.getCell(o+l,2);await d.load("values"),await t.sync(),E.debug&&console.log("Nom du consultant :",d.values[0][0]);const u=a.worksheets.getItem(d.values[0][0]);await u.load("name"),await t.sync(),E.debug&&console.log("Feuille du consultant",u.name,"chargée");const g=s.getCell(o+l,1);await g.load("values"),await t.sync(),E.debug&&console.log("Nom Mission :",r,"Cellule :",o+l,2);const f=u.getRange("C7:C"+(parseInt(i)+6));await f.load("values"),await t.sync();const m=f.values.flat();E.debug&&console.log("Valeurs aplaties de la plage C7:C :",m);let b=m.indexOf(r);if(-1!==b){E.debug&&console.log("Index trouvé pour la mission :",b);for(let o=0;o<e.columnCount;o++)u.getRange("D7").getCell(b,n+o-3).values=[[c]]}else E.debug&&console.log("Aucun index trouvé pour la mission.");k(r,g.values[0][0],d.values[0][0])}}await t.sync(),e.clear(Excel.ClearApplyTo.contents),E.debug&&console.log("Contenu de la plage modifiée supprimé :",e.address),E.debug&&console.log("Calcul déclenché après modification de la feuille",s.name),await t.sync(),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de la modification du planning mission: "+e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}(e,e.rowIndex,e.columnIndex),await t.sync(),await Excel.run(async e=>e.application.calculate())}n.address.includes("B2")&&(E.debug&&console.log("Modification détectée dans la plage B2"),await Excel.run(async e=>e.application.calculate()),await e(),await o())}}catch(e){E.debug=!0,console.error("Erreur lors du traitement de la modification : "+e)}finally{E.debug&&console.log("Réactivation du gestionnaire onChanged"),i.onChanged.add(c),app=a.application,app.load("calculationState"),Excel.run(async e=>{e.workbook.application.calculate(Excel.CalculationType.full),await e.sync()}),await t.sync(),E.debug&&console.log("calculationState =",app.calculationState),E.debug=!0,E.isProcessing=!1}}).catch(e=>{console.error("Erreur lors de la gestion des modifications de la feuille : "+e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo)),E.isProcessing=!1,E.debug=!0})):E.debug&&console.log("Modification stopée car pas demandée par l'utilisateur")}async function r(){await Excel.run(async e=>{E.debug=!1,console.log("Activation de la feuille 3. Planning - Global");const o=e.workbook;e.application.calculate();const n=o.names.getItem("Recap_2").getRange();await e.sync();const t=n.conditionalFormats;await t.load("items"),await e.sync();const a=t.items.length;for(let o=0;o<a;o++){E.debug&&console.log(`Traitement du format ${o} sur ${a}`);const s=t.getItemAt(o);await e.sync(),E.debug&&(console.log("Format condition",s),console.log("Ancienne plage :",s.address)),s.setRanges(n),await e.sync();const l=s.getRanges();await l.load("address"),await e.sync(),E.debug&&console.log("Nouvelle plage :",l.address)}await e.sync(),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de l'exécution de ActivationPlanningGlobal :",e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}async function d(e){E.debug=!1,E.debug&&console.log("Fonction ChgtFeuilleGlobal exécutée"),E.isProcessing?E.debug&&console.log("Une modification est déjà en cours de traitement. Ignorée."):(E.isProcessing=!0,await Excel.run(async o=>{E.debug&&console.log("Détection de modification dans la feuille",E.nbExecModifGlobal++,"fois");const n=o.workbook,t=n.worksheets.getActiveWorksheet(),a="3. Planning - Global",s=o.workbook.worksheets.getItem(a);E.debug&&console.log("Désactivation temporaire du gestionnaire onChanged"),s.onChanged.remove(d);try{if(await t.load("name"),await o.sync(),E.debug&&console.log("Feuille active :",t.name),t.name===a&&e.address.includes("B3")){E.debug&&console.log("Modification détectée dans la plage B3"),await Excel.run(async e=>e.application.calculate());const e=n.names.getItem("Recap_2").getRange();await o.sync();const t=e.conditionalFormats;await t.load("items"),await o.sync();const a=t.items.length;for(let n=0;n<a;n++){E.debug&&console.log(`Traitement du format ${n} sur ${a}`);const s=t.getItemAt(n);await o.sync(),E.debug&&(console.log("Format condition",s),console.log("Ancienne plage :",s.address)),s.setRanges(e),await o.sync();const l=s.getRanges();await l.load("address"),await o.sync(),E.debug&&console.log("Nouvelle plage :",l.address)}}E.debug=!0}catch(e){E.debug=!0,console.error("Erreur lors du traitement de la modification : "+e)}finally{E.debug&&console.log("Réactivation du gestionnaire onChanged"),s.onChanged.add(d),await o.sync(),E.isProcessing=!1,E.debug=!0}}).catch(e=>{console.error("Erreur lors de la gestion des modifications de la feuille : "+e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo)),E.isProcessing=!1,E.debug=!0}))}async function u(){await Excel.run(async e=>{E.debug=!1,console.log("Activation de la feuille 3. Planning - Encadrant");const o=e.workbook;e.application.calculate();const n=o.names.getItem("Recap_3").getRange();await e.sync();const t=n.conditionalFormats;await t.load("items"),await e.sync();const a=t.items.length;for(let o=0;o<a;o++){E.debug&&console.log(`Traitement du format ${o} sur ${a}`);const s=t.getItemAt(o);await e.sync(),E.debug&&(console.log("Format condition",s),console.log("Ancienne plage :",s.address)),s.setRanges(n),await e.sync();const l=s.getRanges();await l.load("address"),await e.sync(),E.debug&&console.log("Nouvelle plage :",l.address)}await e.sync(),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de l'exécution de ActivationPlanningEncadrant :",e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}async function g(e){E.debug=!1,E.debug&&console.log("Fonction ChgtFeuilleEncadrant exécutée"),E.isProcessing?E.debug&&console.log("Une modification est déjà en cours de traitement. Ignorée."):(E.isProcessing=!0,await Excel.run(async o=>{E.debug&&console.log("Détection de modification dans la feuille",E.nbExecModifEncadrant++,"fois");const n=o.workbook,t=n.worksheets.getActiveWorksheet(),a="3. Planning - Encadrant",s=o.workbook.worksheets.getItem(a);E.debug&&console.log("Désactivation temporaire du gestionnaire onChanged"),s.onChanged.remove(g);try{if(await t.load("name"),await o.sync(),E.debug&&console.log("Feuille active :",t.name),t.name===a&&e.address.includes("B2")|e.address.includes("B3")){E.debug&&console.log("Modification détectée dans la plage B2:B3"),await Excel.run(async e=>e.application.calculate());const e=n.names.getItem("Recap_3").getRange();await o.sync();const t=e.conditionalFormats;await t.load("items"),await o.sync();const a=t.items.length;for(let n=0;n<a;n++){E.debug&&console.log(`Traitement du format ${n} sur ${a}`);const s=t.getItemAt(n);await o.sync(),E.debug&&(console.log("Format condition",s),console.log("Ancienne plage :",s.address)),s.setRanges(e),await o.sync();const l=s.getRanges();await l.load("address"),await o.sync(),E.debug&&console.log("Nouvelle plage :",l.address)}}E.debug=!0}catch(e){E.debug=!0,console.error("Erreur lors du traitement de la modification : "+e)}finally{E.debug&&console.log("Réactivation du gestionnaire onChanged"),s.onChanged.add(g),await o.sync(),E.isProcessing=!1,E.debug=!0}}).catch(e=>{console.error("Erreur lors de la gestion des modifications de la feuille : "+e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo)),E.isProcessing=!1,E.debug=!0}))}i.d({},{T$:()=>k,D_:()=>E,Io:()=>C});var f=i(19152);function m(e){document.querySelectorAll("section").forEach(e=>{e.style.display="none"}),document.getElementById(e).style.display="flex"}async function b(e){E.debug=!1;const o=e.target.id;if(E.debug&&console.log("Id du bouton :",o),"btn-open-planning"==o)console.log("🔗 Bouton Ouvrir le planning cliqué"),window.open(f.X,"_blank");else if("btn-AjoutMission"==o)await Excel.run(async e=>{const o=e.workbook.worksheets.getItem("1. Liste des missions").getRange("B:B").getUsedRange();await o.load("values");const n=e.workbook.names.getItem("Nb_Missions_Max");await n.load("value"),await e.sync();let t=o.values.flat().filter(e=>""!==e).length-1;E.debug&&console.log(o.values.flat()),o.values.flat().includes(0)&&(t=1),E.debug&&console.log("Nb Mission :",t,"nbMissionsMax :",n.value),t<n.value?(m("sec-userForm-AjoutMission"),document.getElementById("input-text-Mission").value="",document.getElementById("input-text-Mission").placeholder="Saisissez un texte",w("Liste_Encadrant","dropdown-Mission"),document.getElementById("btn-validate-AjoutMission").addEventListener("click",b)):(E.debug&&console.log("Nombre de mission max atteint"),m("sec-userForm-AjoutMissionError"),document.getElementById("btn-validate-AjoutMissionError").addEventListener("click",b))});else if("btn-validate-AjoutMission"==o)m("sec-userForm-SelectionConsultant"),w("Liste_Consultants_Triée","listbox-SelectionConsultant"),document.getElementById("btn-validate-SelectionConsultant").addEventListener("click",p);else if("btn-Suppression"==o||"btn-validate-AjoutMissionError"==o)m("sec-userForm-SuppressionMission"),w("Liste_Missions_Triée","listbox-SuppressionMission"),document.getElementById("btn-validate-SuppressionMission").addEventListener("click",b);else if("btn-validate-SuppressionMission"==o){m("sec-userForm-SuppressionMissionInter");let e=document.getElementById("listbox-SuppressionMission").selectedOptions.length,o="Voulez-vous supprimer "+e+" missions ?";1==e&&(o="Voulez-vous supprimer "+e+" mission ?"),document.getElementById("texte-SuppressionMissionInter").innerText=o,document.getElementById("btn-validate-SuppressionMissionInter").addEventListener("click",y)}else"btn-ModifierAffectationMission"==o?(m("sec-userForm-ModifierAffectationMission"),w("Liste_Consultants_Update","listbox-AjouterConsultant"),w("Liste_Consultant_Mission","listbox-EnleverConsultant"),document.getElementById("btn-validate-ModifierAffectationMission").addEventListener("click",v)):"btn-ModifierAffectationConsultant"==o?(m("sec-userForm-ModifierAffectationConsultant"),w("Liste_Missions_Update2","listbox-AjouterMission"),w("Liste_Mission_Consultant","listbox-EnleverMission"),document.getElementById("btn-validate-ModifierAffectationConsultant").addEventListener("click",x)):o.includes("btn-return")?(E.debug&&console.log("Bouton retour"),C()):(E.debug=!1,console.error("Aucune action définie pour ",o));E.debug=!1}async function w(e,o){try{await Excel.run(async n=>{E.debug=!1,E.debug&&console.log("Ajout des options pour :",o,"à partir de la liste",e);const t=n.workbook.names.getItem(e).getRange();t.load("values"),await n.sync(),E.debug&&console.log("Valeurs de ",e,":",t.values);const a=document.getElementById(o);if(a.innerHTML="",t.values.forEach(e=>{if(e[0]){const o=document.createElement("option");o.value=e[0],o.textContent=e[0],a.appendChild(o)}}),!o.includes("listbox")){const e=document.createElement("option");e.value="",e.textContent="Sélectionnez une option",e.selected=!0,e.disabled=!0,a.insertBefore(e,a.firstChild)}})}catch(o){console.error("Erreur lors du chargement de la liste",e," :",o)}}async function p(){E.debug=!1,E.debug&&console.log("Lancement fonction nouvelleMission");const t=document.getElementById("input-text-Mission").value,a=document.getElementById("dropdown-Mission").value,s=Array.from(document.getElementById("listbox-SelectionConsultant").selectedOptions).map(e=>e.value);E.debug&&console.log("nomMission :",t,"\nnomEncadrant :",a,"\nlsConsultants :",s),await Excel.run(async l=>{l.application.screenUpdating=!1;const i=l.workbook.worksheets.getActiveWorksheet(),c=l.workbook.worksheets.getItem("1. Liste des missions"),r=l.workbook.worksheets.getItem("Affectation des consultants"),d=l.workbook.names.getItem("Liste_Missions").getRange();await d.load("values");const u=l.workbook.names.getItem("Nb_Missions_Max");await u.load("value");const g=l.workbook.names.getItem("Liste_Consultants").getRange();await g.load("values"),await l.sync();let f=d.values.length+3;d.values.flat().includes(0)&&(f=d.values.flat().findIndex(e=>0===e)+3),c.protection.unprotect(),await l.sync(),E.debug&&console.log("index nouvelle mission",f),c.getCell(f,1).values=[[t]],c.getCell(f,2).values=[[a]],await l.sync();for(let e=0;e<s.length;e++){const o=s[e],n=g.values.flat().findIndex(e=>e===o)+1;E.debug&&console.log("nom :",o,"\nrangeConsultant",g.values.flat(),"indexName :",n),r.getCell(f,n+2).values=[["Affecté à la mission"]]}c.protection.protect(),r.calculate(),await l.sync(),"2. Planning - Consultant"===i.name?await n():"2. Planning - Missions"===i.name&&await o(),await e(),l.application.screenUpdating=!0,E.debug=!0,m("sec-userForm-AjoutMissionOk"),document.getElementById("texte-AjoutMissionOK").innerText="Nom : "+t+"\nEncadrant : "+a+"\nConsultants : "+s}).catch(e=>{E.debug=!0,console.error("Erreur lors l'ajout de l'ajout de mission : "+e),e instanceof OfficeExtension.Error&&console.error("Error debug info: "+JSON.stringify(e.debugInfo))})}async function y(){E.debug=!1,E.debug&&console.log("Lancement fonction suppressionMission");const t=Array.from(document.getElementById("listbox-SuppressionMission").selectedOptions).map(e=>e.value);E.debug&&console.log("lsMissionsASuppr",t),await Excel.run(async a=>{a.application.screenUpdating=!1;const s=a.workbook.worksheets.getActiveWorksheet(),l=a.workbook.worksheets.getItem("Affectation des consultants"),i=a.workbook.worksheets.getItem("1. Liste des missions"),c=a.workbook.names.getItem("Liste_Missions").getRange();await c.load("values");const r=a.workbook.names.getItem("Liste_Consultants").getRange();await r.load("values"),await s.load("name"),await a.sync();for(let e=0;e<t.length;e++){const o=t[e],n=c.values.flat().findIndex(e=>e===o)+1;E.debug&&console.log("Nom mission :",o,"\nindexMission :",n);const s=l.getRangeByIndexes(n+2,3,1,r.values.length);await s.load("values"),await a.sync();const d=s.values.flat().map((e,o)=>""!=e?o:-1).filter(e=>-1!=e),u=d.map(e=>r.values.flat()[e]);E.debug&&console.log("rangeAffectation",s.values.flat(),"\nlsIndex",d,"\nlsConsultants",u);for(const e of u){E.debug&&console.log("constName",e);const o=a.workbook.worksheets.getItem(e);await a.sync();const t=o.getRangeByIndexes(n+5,4,1,78);await t.load("values"),await a.sync(),E.debug&&console.log("rangeNbJoursMissions",t.values.flat()),0!=t.values.flat().filter(e=>""!=e).length&&(t.values=[Array(78).fill("")],await a.sync())}s.values=[Array(r.values.length).fill("")],i.protection.unprotect(),i.getRangeByIndexes(n+2,1,1,2).values=[Array(2).fill(0)],i.protection.protect(),await a.sync()}a.application.calculate(),"2. Planning - Consultant"===s.name?await n():"2. Planning - Missions"===s.name&&await o(),await e(),a.application.screenUpdating=!0,E.debug=!0,m("sec-userForm-SuppressionMissionOk"),document.getElementById("texte-SuppressionMissionOk").innerText="Nom : "+t}).catch(e=>{E.debug=!0,console.error("Erreur lors l'ajout de l'ajout de mission : "+e),e instanceof OfficeExtension.Error&&console.error("Error debug info: "+JSON.stringify(e.debugInfo))})}async function v(){E.debug=!1,E.debug&&console.log("Lancement fonction affectationMission");const n=Array.from(document.getElementById("listbox-AjouterConsultant").selectedOptions).map(e=>e.value),t=Array.from(document.getElementById("listbox-EnleverConsultant").selectedOptions).map(e=>e.value);E.debug&&console.log("lsConsultantsAAjouter",n,"\nlsConsultantsASuppr",t),await Excel.run(async a=>{a.application.screenUpdating=!1;const s=a.workbook.worksheets.getItem("Affectation des consultants"),l=a.workbook.worksheets.getItem("2. Planning - Missions"),i=a.workbook.names.getItem("Liste_Missions").getRange();await i.load("values");const c=a.workbook.names.getItem("Liste_Consultants").getRange();await c.load("values"),await a.sync();const r=l.getCell(1,1);await r.load("values"),await a.sync();const d=i.values.flat().findIndex(e=>e===r.values[0][0])+1;E.debug&&console.log("Nom de la mission :",r.values[0][0],"indexMission",d);for(const e of n){E.debug&&console.log("constName à ajouter",e);const o=c.values.flat().findIndex(o=>o===e)+1;s.getCell(d+2,o+2).values=[["Affecté à la mission"]]}for(const e of t){E.debug&&console.log("constName à suppr",e);const o=a.workbook.worksheets.getItem(e);await a.sync();const n=o.getRangeByIndexes(d+5,4,1,78);await n.load("values"),await a.sync(),E.debug&&console.log("rangeNbJoursMissions",n.values.flat()),0!=n.values.flat().filter(e=>""!=e).length&&(n.values=[Array(78).fill("")],await a.sync());const t=c.values.flat().findIndex(o=>o===e)+1;s.getCell(d+2,t+2).values=[[""]]}await a.sync(),a.application.calculate(),await a.sync(),await o(),await e(),a.application.screenUpdating=!0,E.debug=!0,m("sec-userForm-AffectationMissionOk"),document.getElementById("texte-AffectationMissionOk").innerText="Consultant(s) ajouté(s) : "+n+"\nConsultant(s) retiré(s) : "+t}).catch(e=>{E.debug=!0,console.error("Erreur lors l'ajout de la modification de l'affectation à la mission : "+e),e instanceof OfficeExtension.Error&&console.error("Error debug info: "+JSON.stringify(e.debugInfo))})}async function x(){E.debug&&console.log("Lancement fonction affectationConsultant"),E.debug&&console.log("Lancement fonction affectationMission");const o=Array.from(document.getElementById("listbox-AjouterMission").selectedOptions).map(e=>e.value),t=Array.from(document.getElementById("listbox-EnleverMission").selectedOptions).map(e=>e.value);E.debug&&console.log("lsMissionsAAjouter",o,"lsMissionsASuppr",t),await Excel.run(async a=>{a.application.screenUpdating=!1;const s=a.workbook.worksheets.getItem("Affectation des consultants"),l=a.workbook.worksheets.getItem("2. Planning - Consultant"),i=a.workbook.names.getItem("Liste_Missions").getRange();await i.load("values");const c=a.workbook.names.getItem("Liste_Consultants").getRange();await c.load("values"),await a.sync();const r=l.getCell(1,1);await r.load("values"),await a.sync();const d=r.values[0][0],u=c.values.flat().findIndex(e=>e===d)+1;E.debug&&console.log("Nom de la mission :",d,"indexMission",u);for(const e of o){E.debug&&console.log("missionName à ajouter :",e);const o=i.values.flat().findIndex(o=>o===e)+1;s.getCell(o+2,u+2).values=[["Affecté à la mission"]]}for(const e of t){E.debug&&console.log("missionName à suppr",e);const o=i.values.flat().findIndex(o=>o===e)+1,n=a.workbook.worksheets.getItem(d);await a.sync();const t=n.getRangeByIndexes(o+5,4,1,78);await t.load("values"),await a.sync(),E.debug&&console.log("rangeNbJoursMissions",t.values.flat()),0!=t.values.flat().filter(e=>""!=e).length&&(E.debug&&console.log("val a supprimer"),t.values=[Array(78).fill("")],await a.sync()),s.getCell(o+2,u+2).values=[[""]]}await a.sync(),a.application.calculate(),await a.sync(),await n(),await e(),a.application.screenUpdating=!0,E.debug=!0,m("sec-userForm-AffectationConsultantOk"),document.getElementById("texte-AffectationConsultantOk").innerText="Mission(s) ajoutée(s) : "+o+"\nMission(s) retirée(s) : "+t}).catch(e=>{E.debug=!0,console.error("Erreur lors l'ajout de la modification de l'affectation du consultant : "+e),e instanceof OfficeExtension.Error&&console.error("Error debug info: "+JSON.stringify(e.debugInfo))})}const E={debug:!0,isProcessing:!1,nbExecModifConsultant:1,nbExecModifMission:1,nbExecModifEncadrant:1,nbExecModifGlobal:1};async function C(e){await Excel.run(async e=>{const o=e.workbook.worksheets.getActiveWorksheet(),n=e.workbook.properties;n.load("title"),await o.load("name"),await e.sync(),I(o.name,n.title)})}function I(e,o){try{document.querySelectorAll("section").forEach(e=>{e.style.display="none"}),console.log("avant boucle :",e,o),"1. Liste des missions"===e?(console.log("boucle 1 :",e,o),document.getElementById("sec-btn-AjoutMission").style.display="flex",document.getElementById("sec-btn-Suppression").style.display="flex"):"2. Planning - Missions"===e?(console.log("boucle 2 :",e,o),document.getElementById("sec-btn-AjoutMission").style.display="flex",document.getElementById("sec-btn-Suppression").style.display="flex",document.getElementById("sec-btn-ModifierAffectationMission").style.display="flex"):"2. Planning - Consultant"===e?(console.log("boucle 3 :",e,o),document.getElementById("sec-btn-AjoutMission").style.display="flex",document.getElementById("sec-btn-Suppression").style.display="flex",document.getElementById("sec-btn-ModifierAffectationConsultant").style.display="flex"):o!==f.x&&(console.log("boucle 4 :",e,o),document.getElementById("sec-btn-OpenPlanning").style.display="flex")}catch(e){console.error("Erreur lors de la mise à jour du volet :",e)}}async function k(e,o,n){await Excel.run(async t=>{E.debug=!0;const a=t.workbook.worksheets.getItem("Suivi Modif");await a.load("name");let s=a.getRange("A:A").getUsedRange();await s.load("rowCount"),await t.sync();let l=s.rowCount+1;E.debug&&console.log("Nombre de lignes utilisées dans wsSuivi :",l),a.getCell(l-1,0).values=[[e]],a.getCell(l-1,1).values=[[o]],a.getCell(l-1,2).values=[[n]];let i="Utilisateur inconnu";E.debug&&console.log("Office.context :",Office.context),Office.context&&Office.context.user&&Office.context.user.displayName?i=Office.context.user.displayName:console.warn("Impossible de récupérer le nom de l'utilisateur."),await t.sync(),a.getCell(l-1,3).values=[[i]];const c=new Date,r=`${String(c.getDate()).padStart(2,"0")}/${String(c.getMonth()+1).padStart(2,"0")}/${c.getFullYear()} ${String(c.getHours()).padStart(2,"0")}:${String(c.getMinutes()).padStart(2,"0")}:${String(c.getSeconds()).padStart(2,"0")}`;a.getCell(l-1,4).values=[[r]],E.debug&&console.log("Informations de suivi ajoutées pour la ligne :",l),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors l'ajout du suivi des modifications : "+e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}async function h(){await Excel.run(async e=>{E.debug=!1,E.debug&&console.log("Activation de la feuille 3. Recap");const o=e.application;o.screenUpdating=!1,o.calculate(),await t("3. Recap",3),o.screenUpdating=!0,await e.sync(),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de l'exécution de ActivationRecap :",e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}async function M(){await Excel.run(async e=>{E.debug=!1,E.debug&&console.log("Activation de la feuille 1. Liste des missions");const o=e.application;o.screenUpdating=!1,o.calculate(),await t("1. Liste des missions",3),o.screenUpdating=!0,await e.sync(),E.debug=!0}).catch(e=>{E.debug=!0,console.error("Erreur lors de l'exécution de ActivationListeMissions :",e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}E.debug&&console.log(E.isProcessing),Office.onReady(e=>{e.host===Office.HostType.Excel&&(E.debug&&console.log("Office est prêt, chargement de la fonction qui se déclenche s'il y a un changement sur le fichier"),async function(){await Excel.run(async e=>{if(E.debug&&console.log("Initialisation du classeur : Désactivation du calcul automatique"),e.application.calculationMode=Excel.CalculationMode.manual,E.debug){const o=e.application;await o.load("calculationState"),await e.sync(),console.log("calculationState initial",o.calculationState)}const o=e.workbook;E.debug&&console.log(o),o.worksheets.onActivated.add(C);const n=o.properties;n.load("title");const t=o.worksheets.getActiveWorksheet();await t.load("name"),await e.sync(),I(t.name,n.title),await e.sync(),E.debug&&console.log("Calcul automatique désactivé")}).catch(e=>{console.error("Erreur lors de l'initialisation du classeur : "+e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))})}(),Excel.run(async e=>{E.debug&&console.log("Ajout du gestionnaire de boutons.");const o=e.workbook.worksheets.getActiveWorksheet();await o.load("name"),await e.sync(),E.debug&&console.log("Ajout des gestionnaires de changement pour les feuilles '1. Liste des missions', '2. Planning - Consultant', '2. Planning - Missions', '3. Planning - Encadrant, '3. Planning - Global' et '3. Recap'");const n=e.workbook.worksheets.getItem("2. Planning - Consultant");n.onActivated.add(a),n.onChanged.add(s),E.debug&&console.log("Chargement des fonctions de la feuille",n);const t=e.workbook.worksheets.getItem("2. Planning - Missions");t.onActivated.add(l),t.onChanged.add(c),E.debug&&console.log("Chargement des fonctions de la feuille",t);const i=e.workbook.worksheets.getItem("3. Planning - Encadrant");i.onActivated.add(u),i.onChanged.add(g),E.debug&&console.log("Chargement des fonctions de la feuille",i);const f=e.workbook.worksheets.getItem("3. Planning - Global");f.onActivated.add(r),f.onChanged.add(d),E.debug&&console.log("Chargement des fonctions de la feuille",f);const m=e.workbook.worksheets.getItem("3. Recap");m.onActivated.add(h),E.debug&&console.log("Chargement des fonctions de la feuille",m);const b=e.workbook.worksheets.getItem("1. Liste des missions");b.onActivated.add(M),E.debug&&console.log("Chargement des fonctions de la feuille",b),E.debug&&console.log("Gestionnaire de changement ajouté.")}).catch(function(e){console.error("Erreur : "+e),e instanceof OfficeExtension.Error&&console.error("Error globalVar.debug info: "+JSON.stringify(e.debugInfo))}),document.getElementById("btn-AjoutMission").addEventListener("click",b),document.getElementById("btn-Suppression").addEventListener("click",b),document.getElementById("btn-ModifierAffectationMission").addEventListener("click",b),document.getElementById("btn-ModifierAffectationConsultant").addEventListener("click",b),document.getElementById("btn-open-planning").addEventListener("click",b),document.querySelectorAll('[id*="btn-return"]').forEach(e=>{e.addEventListener("click",b)}))})})(),e=i(14385),o=i.n(e),n=new URL(i(60947),i.b),t=new URL(i(58394),i.b),a=new URL(i(98362),i.b),o()(n),o()(t),o()(a)})();